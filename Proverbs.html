<!DOCTYPE html>
<html lang="en" data-bs-theme="auto">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Random Proverbs (ABTAG2001) Redirect</title>
  <meta name="robots" content="noindex, nofollow" />

  <!-- Bootstrap 5 (CSS only) -->
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
    rel="stylesheet"
    integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
    crossorigin="anonymous"
  />

  <style>
    :root{
      --bg: #f5f5f7;
      --sq: rgba(255,255,255,0.55);
      --sq-border: rgba(0,0,0,0.08);
      --sq-active: #000; /* used only for outline pulse */
      --text: #111;
    }
    @media (prefers-color-scheme: dark){
      :root{
        --sq: rgba(0,0,0,0.25);
        --sq-border: rgba(255,255,255,0.10);
        --text: #f6f6f7;
      }
    }

    html, body { height: 100%; margin: 0; }
    body {
      background: var(--bg);
      color: var(--text);
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Arial, sans-serif;
    }

    .viewport {
      min-height: 100dvh;
      display: grid;
      grid-template-rows: auto 1fr auto;
    }

    /* Header & footer */
    header, footer {
      padding: .5rem 1rem;
      backdrop-filter: blur(8px);
    }
    header .lead { font-size: 0.95rem; }

    /* Squares grid */
    .grid-wrap{
      position: relative;
      padding: 6px;
      /* Keep grid centered with max width for very wide screens */
      max-width: 1400px;
      width: 100%;
      margin: 0 auto;
    }
    .grid{
      display: grid;
      /* auto-fit squares; minmax ensures reasonable size on mobile */
      grid-template-columns: repeat(auto-fill, minmax(min(6.8vmin, 26px), 1fr));
      gap: 2px;
      align-content: center;
      justify-content: center;
    }
    /* If very small screen, make squares a bit larger for legibility */
    @media (max-width: 420px){
      .grid{ grid-template-columns: repeat(auto-fill, minmax(22px, 1fr)); }
    }

    .sq{
      aspect-ratio: 1 / 1;
      border: 1px solid var(--sq-border);
      background: var(--sq);
      border-radius: 3px;
      box-shadow: inset 0 0 0 1px rgba(255,255,255,0.04);
      transition: transform .15s ease;
      will-change: transform;
    }
    /* Subtle hover on devices that support hover */
    @media (hover:hover){
      .sq:hover{ transform: scale(1.06); }
    }

    /* Blink animation for the picked square */
    @keyframes pulseOutline {
      0%   { box-shadow: 0 0 0 0 var(--sq-active); transform: scale(1.00); }
      50%  { box-shadow: 0 0 0 4px rgba(255,255,255,0.85), 0 0 0 8px rgba(0,0,0,0.35); transform: scale(1.08); }
      100% { box-shadow: 0 0 0 0 var(--sq-active); transform: scale(1.00); }
    }
    .blink {
      animation: pulseOutline 900ms ease-in-out infinite;
    }
    @media (prefers-reduced-motion: reduce){
      .blink { animation: none; outline: 3px solid #fff; outline-offset: -3px; }
      .sq{ transition: none; }
    }

    .sr-only {
      position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px;
      overflow: hidden; clip: rect(0,0,0,0); white-space: nowrap; border: 0;
    }

    .linkbox a { word-break: break-all; }
    code { background: #f3f3f5; padding: 0.15rem 0.35rem; border-radius: 6px; }
  </style>

  <script>
    // ----- Data: total verses in Proverbs (ABTAG2001) -----
    const chapterVerseCounts = [33,22,35,27,23,35,27,36,18,32,31,28,25,35,33,33,28,24,29,30,31,29,35,34,28,28,27,28,27,33,31];
    const totalVerses = chapterVerseCounts.reduce((a,b)=>a+b,0); // 915

    // ----- “Pantone-style” palette (unofficial hex approximations & nicknames) -----
    const pantoneLike = [
      {name:"Classic Blue", hex:"#34558B"},
      {name:"Living Coral", hex:"#FF6F61"},
      {name:"Ultra Violet", hex:"#5F4B8B"},
      {name:"Marsala", hex:"#955251"},
      {name:"Greenery", hex:"#88B04B"},
      {name:"Radiant Orchid", hex:"#B565A7"},
      {name:"Illuminating", hex:"#F5DF4D"},
      {name:"Very Peri", hex:"#6667AB"},
      {name:"Viva Magenta", hex:"#BB2649"},
      {name:"Peach Fuzz", hex:"#FFBE98"},
      {name:"Aqua Sky", hex:"#7BC4C4"},
      {name:"Tangerine Tango", hex:"#DD4124"},
      {name:"Emerald", hex:"#009473"},
      {name:"Cerulean", hex:"#9BB7D4"},
      {name:"Mimosa", hex:"#F0C05A"},
      {name:"Chili Pepper", hex:"#9B1B30"}
    ];

    function randomPantoneExcept(lastHex){
      const choices = pantoneLike.filter(p=>p.hex !== lastHex);
      return choices[Math.floor(Math.random() * choices.length)];
    }

    // ----- Random picker: maps n -> (chapter, verse) -----
    function pickRandomVerse() {
      const n = Math.floor(Math.random() * totalVerses) + 1; // 1..915
      let remaining = n;
      for (let i = 0; i < chapterVerseCounts.length; i++) {
        const size = chapterVerseCounts[i];
        if (remaining <= size) {
          return { chapter: i + 1, verse: remaining, n };
        }
        remaining -= size;
      }
      return { chapter: 31, verse: 31, n: totalVerses }; // safety
    }

    function buildUrl(chapter, verse) {
      const book = "Mga Kawikaan";
      const q = encodeURIComponent(book + " " + chapter + ":" + verse);
      const version = "ABTAG2001";
      return "https://www.biblegateway.com/passage/?search=" + q + "&version=" + version;
    }

    // ----- Helpers -----
    function isMobile(){
      return /Mobi|Android|iPhone|iPad|iPod/i.test(navigator.userAgent);
    }
    function setBackgroundPantone(){
      try{
        const last = localStorage.getItem("lastPantoneHex") || "";
        const pick = randomPantoneExcept(last);
        document.documentElement.style.setProperty("--bg", pick.hex);
        // tweak square base fill depending on bg brightness (simple luma check)
        const r = parseInt(pick.hex.slice(1,3),16),
              g = parseInt(pick.hex.slice(3,5),16),
              b = parseInt(pick.hex.slice(5,7),16);
        const luma = 0.2126*r + 0.7152*g + 0.0722*b;
        const sq = luma < 128 ? "rgba(255,255,255,0.25)" : "rgba(0,0,0,0.12)";
        const sqBorder = luma < 128 ? "rgba(255,255,255,0.22)" : "rgba(0,0,0,0.12)";
        const text = luma < 128 ? "#f6f6f7" : "#111";
        document.documentElement.style.setProperty("--sq", sq);
        document.documentElement.style.setProperty("--sq-border", sqBorder);
        document.documentElement.style.setProperty("--text", text);
        localStorage.setItem("lastPantoneHex", pick.hex);

        const chip = document.getElementById("pantone-chip");
        if (chip) chip.textContent = `${pick.name} ${pick.hex}`;
      }catch(e){}
    }

    // Build the 915-square grid
    function buildGrid(nth){
      const grid = document.getElementById("grid");
      const frag = document.createDocumentFragment();
      for(let i=1;i<=totalVerses;i++){
        const div = document.createElement("div");
        div.className = "sq";
        div.setAttribute("aria-hidden","true");
        if(i === nth) div.classList.add("blink");
        frag.appendChild(div);
      }
      grid.appendChild(frag);
    }

    function bootstrapInfoBar({url, n, chapter, verse}){
      const link = document.getElementById("link");
      link.href = url;
      link.textContent = url + "  (picked #" + n + " → " + chapter + ":" + verse + ")";
      const aria = document.getElementById("aria-status");
      aria.textContent = `Selected #${n} (Proverbs ${chapter}:${verse}). Redirecting in 5 seconds…`;
    }

    function go(){
      setBackgroundPantone();

      // Pick verse & URL
      const { chapter, verse, n } = pickRandomVerse();
      const url = buildUrl(chapter, verse);

      // Build squares and highlight nth
      buildGrid(n);

      // Device-adaptive tweaks
      if(isMobile()){
        // Slightly larger squares already handled via CSS @media
        // Keep page responsive; no extra changes needed here
      }

      // Show info & schedule redirect
      bootstrapInfoBar({url, n, chapter, verse});

      const delayMs = 5000;
      setTimeout(()=>{ window.location.replace(url); }, delayMs);
    }

    document.addEventListener("DOMContentLoaded", go);
  </script>
</head>
<body>
  <div class="viewport">
    <header class="d-flex align-items-center justify-content-between">
      <div class="d-flex align-items-center gap-2">
        <span class="fw-semibold">Random Proverbs Redirect</span>
        <span class="badge text-bg-dark-subtle border">ABTAG2001</span>
      </div>
      <div class="text-end small">
        <span class="text-body-secondary">Background:</span>
        <span id="pantone-chip" class="badge text-bg-light-subtle border">…</span>
      </div>
    </header>

    <main class="grid-wrap">
      <p id="aria-status" class="sr-only" aria-live="polite"></p>
      <div id="grid" class="grid" role="img" aria-label="Screen filled with 915 squares. The selected one blinks for five seconds before redirect."></div>
    </main>

    <footer class="linkbox small text-center text-body-secondary">
      If you are not redirected automatically, click:
      <br><a id="link" href="#" class="link-underline link-underline-opacity-0">loading…</a>
      <div class="mt-1">Tip: Refresh to pick a new random verse.</div>
    </footer>
  </div>
</body>
</html>
